<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DutyPlanner Pro - Stable Version</title>
    <style>
        :root { --primary: #4361ee; --dark-red: #8b0000; --bg: #f8f9fd; --sidebar-bg: #1e1e2d; --viber-bg: #7360f2; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); margin: 0; display: flex; height: 100vh; overflow: hidden; }

        #sidebar { width: 340px; background: var(--sidebar-bg); color: white; padding: 20px; overflow-y: auto; flex-shrink: 0; }
        #main { flex-grow: 1; padding: 20px; overflow-y: auto; background: white; }

        .input-group { margin-bottom: 15px; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; }
        label { display: block; font-size: 12px; margin-bottom: 5px; color: #4361ee; font-weight: bold; }
        input, select { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 10px; border-radius: 6px; width: 100%; box-sizing: border-box; }
        
        .today-box { 
            background: linear-gradient(135deg, #8b0000, #c0392b); 
            color: white; padding: 20px; border-radius: 12px; text-align: center; margin-bottom: 30px; 
            box-shadow: 0 10px 20px rgba(139,0,0,0.2);
        }
        .today-name { font-size: 28px; font-weight: 900; margin-bottom: 15px; }

        .btn { padding: 10px; border-radius: 6px; border: none; cursor: pointer; font-weight: 600; width: 100%; transition: 0.2s; margin-top: 5px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-copy { background: #2ecc71; color: white; margin-top: 20px; font-size: 16px; height: 50px; }

        .month-header { display: flex; justify-content: space-between; align-items: center; background: #eef2f7; padding: 15px; margin-top: 30px; border-radius: 10px; border-left: 8px solid var(--dark-red); color: #222; }
        .current-time-inline { font-size: 16px; font-weight: 700; color: #d00000; background: white; padding: 5px 10px; border-radius: 5px; border: 1px solid #ddd; }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        td { border-bottom: 1px solid #eee; padding: 12px 8px; text-align: left; color: #333; }
        .weekend { background: #fff5f5; color: #ef233c; }

        .phone-group { display: flex; flex-direction: column; gap: 5px; width: 100%; }
        .btn-call { background: #007bff; color: white !important; text-decoration: none; padding: 8px; border-radius: 6px; font-size: 13px; font-weight: bold; text-align: center; display: block; }
        .btn-viber { background: var(--viber-bg); color: white !important; text-decoration: none; padding: 6px; border-radius: 6px; font-size: 10px; font-weight: 900; text-align: center; display: block; }

        #codeOutput { display: none; }
    </style>
</head>
<body>

<div id="sidebar">
    <h2 style="color:var(--primary); margin-top:0;">DutyPlanner Pro</h2>
    
    <div class="input-group">
        <label>áƒ’áƒáƒœáƒ áƒ˜áƒ’áƒ˜áƒ¡ áƒ¡áƒáƒ—áƒáƒ£áƒ áƒ˜</label>
        <input type="text" id="topTitleInput" placeholder="áƒ›áƒáƒ’: áƒ“áƒáƒªáƒ•áƒ˜áƒ¡ áƒ’áƒáƒœáƒ áƒ˜áƒ’áƒ˜" oninput="renderPreview()">
    </div>
    
    <div style="display:flex; gap:5px; margin-bottom: 15px;">
        <input type="month" id="startMonth">
        <input type="month" id="endMonth">
    </div>
    <button class="btn btn-primary" style="background:#9b59b6;" onclick="generateRandom()">ğŸ² áƒ’áƒ”áƒœáƒ”áƒ áƒ˜áƒ áƒ”áƒ‘áƒ</button>

    <hr style="opacity:0.1; margin:20px 0;">

    <div class="input-group">
        <label>áƒ›áƒ—áƒáƒ•áƒáƒ áƒ˜ áƒáƒáƒ¡áƒ£áƒ®áƒ˜áƒ¡áƒ›áƒ’áƒ”áƒ‘áƒšáƒ”áƒ‘áƒ˜</label>
        <input type="text" id="adminName" placeholder="áƒ¡áƒáƒ®áƒ”áƒšáƒ˜ áƒ’áƒ•áƒáƒ áƒ˜" style="margin-bottom:5px;">
        <input type="text" id="adminPhone" placeholder="áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜">
        <button class="btn btn-primary" style="background:#e67e22;" onclick="addAdmin()">+ áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ</button>
        <div id="adminList" style="margin-top:10px; font-size:12px;"></div>
    </div>
    
    <div class="input-group">
        <label>áƒáƒ”áƒ áƒ¡áƒáƒœáƒáƒšáƒ˜áƒ¡ áƒ‘áƒáƒ–áƒ</label>
        <input type="text" id="staffName" placeholder="áƒ¡áƒáƒ®áƒ”áƒšáƒ˜">
        <input type="text" id="staffPhone" placeholder="áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜" style="margin-top:5px;">
        <button class="btn btn-primary" onclick="addStaff()">+ áƒ¡áƒ˜áƒáƒ¨áƒ˜ áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ</button>
        <div id="statsUI" style="margin-top:10px; max-height: 150px; overflow-y: auto; font-size:12px;"></div>
    </div>

    <button class="btn btn-copy" onclick="copyFinalHTML()">ğŸ“‹ áƒ™áƒáƒ“áƒ˜áƒ¡ áƒ™áƒáƒáƒ˜áƒ áƒ”áƒ‘áƒ</button>
</div>

<div id="main">
    <div id="schedulePreview"></div>
</div>

<textarea id="codeOutput"></textarea>

<script>
    let staff = JSON.parse(localStorage.getItem('savedStaffContacts')) || [];
    let admins = JSON.parse(localStorage.getItem('savedAdmins')) || [];
    let currentScheduleData = [];
    const monthsKA = ["áƒ˜áƒáƒœáƒ•áƒáƒ áƒ˜", "áƒ—áƒ”áƒ‘áƒ”áƒ áƒ•áƒáƒšáƒ˜", "áƒ›áƒáƒ áƒ¢áƒ˜", "áƒáƒáƒ áƒ˜áƒšáƒ˜", "áƒ›áƒáƒ˜áƒ¡áƒ˜", "áƒ˜áƒ•áƒœáƒ˜áƒ¡áƒ˜", "áƒ˜áƒ•áƒšáƒ˜áƒ¡áƒ˜", "áƒáƒ’áƒ•áƒ˜áƒ¡áƒ¢áƒ", "áƒ¡áƒ”áƒ¥áƒ¢áƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒáƒ¥áƒ¢áƒáƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒœáƒáƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒ“áƒ”áƒ™áƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜"];

    function updateLiveClocks() {
        const now = new Date();
        const timeStr = `${now.getDate()} ${monthsKA[now.getMonth()]} | ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;
        document.querySelectorAll('.current-time-inline').forEach(el => {
            el.innerHTML = `ğŸ“… ${timeStr}`;
        });
    }
    setInterval(updateLiveClocks, 1000);

    function formatViber(p) {
        let clean = p.toString().replace(/\D/g, '');
        if (clean.length === 9) clean = '995' + clean;
        return "viber://contact?number=%2B" + clean;
    }

    function addAdmin() {
        const n = document.getElementById('adminName'), p = document.getElementById('adminPhone');
        if(n.value.trim()) { 
            admins.push({ name: n.value.trim(), phone: p.value.trim() }); 
            localStorage.setItem('savedAdmins', JSON.stringify(admins)); 
            updateAdminUI(); renderPreview(); n.value=""; p.value=""; 
        }
    }

    function updateAdminUI() { 
        document.getElementById('adminList').innerHTML = admins.map((a, i) => 
            `<div style="display:flex; justify-content:space-between; margin-bottom:3px;">
                <span>${a.name}</span>
                <span onclick="admins.splice(${i},1); localStorage.setItem('savedAdmins', JSON.stringify(admins)); updateAdminUI(); renderPreview();" style="color:red; cursor:pointer;">Ã—</span>
            </div>`).join(''); 
    }

    function addStaff() {
        const n = document.getElementById('staffName'), p = document.getElementById('staffPhone');
        if(n.value.trim()) { 
            staff.push({ name: n.value.trim(), phone: p.value.trim() }); 
            localStorage.setItem('savedStaffContacts', JSON.stringify(staff)); 
            updateStaffUI(); renderPreview(); n.value=""; p.value=""; 
        }
    }

    function updateStaffUI() { 
        document.getElementById('statsUI').innerHTML = staff.map((s, i) => 
            `<div style="display:flex; justify-content:space-between; margin-bottom:3px;">
                <span>${s.name}</span>
                <span onclick="staff.splice(${i},1); localStorage.setItem('savedStaffContacts', JSON.stringify(staff)); updateStaffUI(); renderPreview();" style="color:red; cursor:pointer;">Ã—</span>
            </div>`).join(''); 
    }

    function generateRandom() {
        const s = document.getElementById('startMonth').value, e = document.getElementById('endMonth').value;
        if(!s || !e || staff.length === 0) return alert("áƒ¨áƒ”áƒáƒ•áƒ¡áƒ”áƒ— áƒáƒ”áƒ áƒ¡áƒáƒœáƒáƒšáƒ˜áƒ¡ áƒ¡áƒ˜áƒ áƒ“áƒ áƒáƒ˜áƒ áƒ©áƒ˜áƒ”áƒ— áƒ—áƒ•áƒ”áƒ”áƒ‘áƒ˜!");
        let shuffled = [...staff].sort(() => Math.random() - 0.5);
        let cur = new Date(Date.UTC(s.split('-')[0], s.split('-')[1]-1, 1));
        const end = new Date(Date.UTC(e.split('-')[0], e.split('-')[1], 0));
        currentScheduleData = [];
        let idx = 0;
        while(cur <= end) {
            let p = shuffled[idx % shuffled.length];
            currentScheduleData.push({ 
                day: cur.getUTCDate(), month: cur.getUTCMonth(), year: cur.getUTCFullYear(), 
                isWeekend: (cur.getUTCDay() === 0 || cur.getUTCDay() === 6), 
                staffName: p.name, staffPhone: p.phone 
            });
            idx++; cur.setUTCDate(cur.getUTCDate() + 1);
        }
        renderPreview();
    }

    function renderPreview() {
        const title = document.getElementById('topTitleInput').value || "áƒ¡áƒáƒ›áƒ£áƒ¨áƒáƒ áƒ’áƒáƒœáƒ áƒ˜áƒ’áƒ˜";
        const now = new Date();
        const todayData = currentScheduleData.find(d => d.day === now.getDate() && d.month === now.getMonth() && d.year === now.getFullYear());

        let todayHTML = todayData ? `<div class="today-box"><h2>ğŸ”” áƒ“áƒ¦áƒ”áƒ•áƒáƒœáƒ“áƒ”áƒšáƒ˜ áƒ›áƒáƒ áƒ˜áƒ’áƒ”</h2><div class="today-name">${todayData.staffName}</div><div class="phone-group" style="max-width:220px; margin:auto;"><a href="tel:${todayData.staffPhone.replace(/\D/g,'')}" class="btn-call" style="background:#fff; color:#8b0000 !important;">ğŸ“ ${todayData.staffPhone}</a><a href="${formatViber(todayData.staffPhone)}" class="btn-viber" style="background:#fff; color:#7360f2 !important;">VIBER</a></div></div>` : "";

        let html = todayHTML + `<h1 style="text-align:center; color:var(--dark-red); font-size:22px;">${title}</h1>`;
        let lastMonth = -1;
        
        currentScheduleData.forEach((item, i) => {
            if (item.month !== lastMonth) {
                if (lastMonth !== -1) html += "</tbody></table>";
                html += `<div class="month-header"><b>${monthsKA[item.month]} ${item.year}</b><span class="current-time-inline"></span></div><table style="width:100%"><tbody>`;
                lastMonth = item.month;
            }
            const options = staff.map(s => `<option value="${s.name}" ${s.name === item.staffName ? 'selected' : ''}>${s.name}</option>`).join('');
            html += `<tr class="${item.isWeekend?'weekend':''}">
                <td style="width:10%; font-weight:bold;">${item.day}</td>
                <td style="width:45%;"><select style="background:white; color:black; border:1px solid #ccc; padding:6px; width:100%; border-radius:4px;" onchange="const p=staff.find(s=>s.name===this.value); currentScheduleData[${i}].staffName=p.name; currentScheduleData[${i}].staffPhone=p.phone; renderPreview();">${options}</select></td>
                <td style="width:45%;">
                    <div class="phone-group">
                        <a href="tel:${item.staffPhone.replace(/\D/g,'')}" class="btn-call">ğŸ“ ${item.staffPhone}</a>
                        <a href="${formatViber(item.staffPhone)}" class="btn-viber">VIBER</a>
                    </div>
                </td>
            </tr>`;
        });

        let adminsHTML = admins.length > 0 ? `<div style="margin-top:40px; border-top:2px solid #eee; padding-top:20px; text-align:center;"><h3 style="color:#555; font-size:14px;">âš ï¸ áƒáƒáƒ¡áƒ£áƒ®áƒ˜áƒ¡áƒ›áƒ’áƒ”áƒ‘áƒ”áƒšáƒ˜ áƒáƒ˜áƒ áƒ”áƒ‘áƒ˜</h3>${admins.map(a => `<div style="margin:15px auto; max-width:250px;"><div style="font-weight:bold; margin-bottom:5px;">${a.name}</div><div class="phone-group"><a href="tel:${a.phone.replace(/\D/g,'')}" class="btn-call">ğŸ“ ${a.phone}</a><a href="${formatViber(a.phone)}" class="btn-viber">VIBER</a></div></div>`).join('')}</div>` : "";

        document.getElementById('schedulePreview').innerHTML = html + "</tbody></table>" + adminsHTML;
        updateLiveClocks();
    }

    function copyFinalHTML() {
        let tempDiv = document.createElement('div');
        tempDiv.innerHTML = document.getElementById('schedulePreview').innerHTML;
        tempDiv.querySelectorAll('select').forEach(s => { 
            let b = document.createElement('b'); 
            b.innerText = s.value; 
            s.parentNode.replaceChild(b, s); 
        });
        
        const final = `<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><style>
            body { font-family: sans-serif; padding: 5px; background: #f9f9f9; }
            .container { max-width: 500px; margin: auto; background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
            .today-box { background: linear-gradient(135deg, #8b0000, #c0392b); color: white; padding: 20px; border-radius: 12px; text-align: center; margin-bottom: 20px; }
            .today-name { font-size: 26px; font-weight: 900; margin-bottom: 12px; }
            .month-header { display: flex; flex-direction: column; align-items: center; background: #eef2f7; padding: 12px; margin-top: 20px; border-radius: 8px; border-left: 6px solid #8b0000; gap: 5px; }
            .current-time-inline { font-size: 14px; font-weight: 700; color: #d00000; background: white; padding: 4px 8px; border-radius: 4px; border: 1px solid #ddd; }
            table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
            td { border-bottom: 1px solid #eee; padding: 10px 5px; font-size: 14px; color: #333; }
            .weekend { background: #fffafa; color: #d9534f; }
            .phone-group { display: flex; flex-direction: column; gap: 4px; }
            .btn-call { background: #007bff; color: white !important; text-decoration: none; padding: 10px; border-radius: 6px; font-size: 12px; font-weight: bold; text-align: center; }
            .btn-viber { background: #7360f2; color: white !important; text-decoration: none; padding: 8px; border-radius: 6px; font-size: 10px; font-weight: 900; text-align: center; }
        </style></head><body><div class="container">${tempDiv.innerHTML}</div>
        <script>
            const m = ["áƒ˜áƒáƒœáƒ•áƒáƒ áƒ˜", "áƒ—áƒ”áƒ‘áƒ”áƒ áƒ•áƒáƒšáƒ˜", "áƒ›áƒáƒ áƒ¢áƒ˜", "áƒáƒáƒ áƒ˜áƒšáƒ˜", "áƒ›áƒáƒ˜áƒ¡áƒ˜", "áƒ˜áƒ•áƒœáƒ˜áƒ¡áƒ˜", "áƒ˜áƒ•áƒšáƒ˜áƒ¡áƒ˜", "áƒáƒ’áƒ•áƒ˜áƒ¡áƒ¢áƒ", "áƒ¡áƒ”áƒ¥áƒ¢áƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒáƒ¥áƒ¢áƒáƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒœáƒáƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒ“áƒ”áƒ™áƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜"];
            setInterval(() => {
                const now = new Date();
                const t = now.getDate() + " " + m[now.getMonth()] + " | " + String(now.getHours()).padStart(2, '0') + ":" + String(now.getMinutes()).padStart(2, '0') + ":" + String(now.getSeconds()).padStart(2, '0');
                document.querySelectorAll('.current-time-inline').forEach(el => el.innerHTML = "ğŸ“… " + t);
            }, 1000);
        <\/script></body></html>`;
        
        const el = document.getElementById('codeOutput'); 
        el.value = final; 
        el.style.display="block"; 
        el.select(); 
        document.execCommand('copy'); 
        el.style.display="none";
        alert("áƒ™áƒáƒ“áƒ˜ áƒ“áƒáƒ™áƒáƒáƒ˜áƒ áƒ“áƒ!");
    }

    window.onload = () => { updateAdminUI(); updateStaffUI(); };
</script>
</body>
</html>
