<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DutyPlanner Pro - Real-Time Sync</title>
    <style>
        :root { --primary: #4361ee; --dark-red: #8b0000; --bg: #f8f9fd; --sidebar-bg: #1e1e2d; --viber-bg: #7360f2; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); margin: 0; display: flex; height: 100vh; overflow: hidden; }

        #sidebar { width: 340px; background: var(--sidebar-bg); color: white; padding: 20px; overflow-y: auto; flex-shrink: 0; }
        #main { flex-grow: 1; padding: 20px; overflow-y: auto; background: white; }

        .input-group { margin-bottom: 15px; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; }
        label { display: block; font-size: 12px; margin-bottom: 5px; color: #4361ee; font-weight: bold; }
        input, select { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 10px; border-radius: 6px; width: 100%; box-sizing: border-box; }
        
        .btn { padding: 10px; border-radius: 6px; border: none; cursor: pointer; font-weight: 600; width: 100%; transition: 0.2s; margin-top: 5px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-copy { background: #2ecc71; color: white; margin-top: 20px; font-size: 16px; height: 50px; }

        .count-badge { background: #4361ee; color: white; padding: 2px 6px; border-radius: 10px; font-size: 10px; margin-left: 5px; }
        #codeOutput { display: none; }

        /* Preview Styles */
        .preview-container { max-width: 500px; margin: auto; background: white; padding: 15px; border-radius: 12px; }
        .today-card { background: linear-gradient(135deg, #8b0000, #c0392b); color: white; padding: 20px; border-radius: 12px; text-align: center; margin-bottom: 20px; }
        .month-row { display: flex; justify-content: space-between; background: #eef2f7; padding: 10px; margin: 15px 0; border-left: 6px solid #8b0000; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; }
        td { padding: 10px 5px; border-bottom: 1px solid #eee; font-size: 14px; }
        .weekend { background: #fff5f5; color: #d9534f; }
        .phone-group { display: flex; flex-direction: column; gap: 4px; }
        .call-btn { background: #007bff; color: white !important; text-decoration: none; padding: 8px; border-radius: 5px; text-align: center; font-size: 12px; font-weight: bold; }
        .viber-btn { background: #7360f2; color: white !important; padding: 6px; border-radius: 5px; text-align: center; font-size: 10px; font-weight: 900; cursor: pointer; }
    </style>
</head>
<body>

<div id="sidebar">
    <h2 style="color:var(--primary); margin-top:0;">DutyPlanner Pro</h2>
    
    <div class="input-group">
        <label>áƒ’áƒáƒœáƒ áƒ˜áƒ’áƒ˜áƒ¡ áƒ¡áƒáƒ—áƒáƒ£áƒ áƒ˜</label>
        <input type="text" id="topTitleInput" placeholder="áƒ›áƒáƒ’: áƒ¢áƒ”áƒ¥áƒœáƒ˜áƒ™áƒ£áƒ áƒ˜ áƒ›áƒáƒ áƒ˜áƒ’áƒ”áƒáƒ‘áƒ" oninput="renderPreview()">
    </div>
    
    <div style="display:flex; gap:5px; margin-bottom: 15px;">
        <input type="month" id="startMonth">
        <input type="month" id="endMonth">
    </div>
    <button class="btn btn-primary" style="background:#9b59b6;" onclick="generateRandom()">ğŸ² áƒ’áƒ”áƒœáƒ”áƒ áƒ˜áƒ áƒ”áƒ‘áƒ</button>

    <div class="input-group">
        <label>áƒ›áƒáƒ áƒ˜áƒ’áƒ”áƒáƒ‘áƒ˜áƒ¡ áƒ¡áƒ¢áƒáƒ¢áƒ˜áƒ¡áƒ¢áƒ˜áƒ™áƒ</label>
        <div id="statsUI" style="margin-top:10px; max-height: 200px; overflow-y: auto; font-size:12px; color: #ccc;"></div>
    </div>

    <button class="btn btn-copy" onclick="copyFinalHTML()">ğŸ“‹ áƒ™áƒáƒ“áƒ˜áƒ¡ áƒ™áƒáƒáƒ˜áƒ áƒ”áƒ‘áƒ</button>
</div>

<div id="main">
    <div id="schedulePreview" class="preview-container"></div>
</div>

<textarea id="codeOutput"></textarea>

<script>
    let staff = [
        { name: "áƒ’áƒ˜áƒáƒ áƒ’áƒ˜ áƒšáƒáƒ›áƒ˜áƒ«áƒ”", phone: "555558222" },
        { name: "áƒ¨áƒáƒšáƒ•áƒ áƒ’áƒáƒ’áƒœáƒ˜áƒ«áƒ”", phone: "551770200" },
        { name: "áƒáƒšáƒ˜áƒ™áƒ áƒ§áƒáƒšáƒ˜áƒ©áƒáƒ•áƒ", phone: "551688899" },
        { name: "áƒ•áƒáƒ¡áƒ˜áƒš áƒ’áƒáƒ’áƒáƒšáƒáƒ«áƒ”", phone: "557949827" },
        { name: "áƒ’áƒ˜áƒáƒ áƒ’áƒ˜ áƒ¢áƒáƒ áƒ§áƒáƒ¨áƒ•áƒ˜áƒšáƒ˜", phone: "577385250" },
        { name: "áƒ’áƒ˜áƒáƒ áƒ’áƒ˜ áƒ‘áƒáƒ­áƒáƒ áƒ˜áƒ¨áƒ•áƒ˜áƒšáƒ˜", phone: "591927831" },
        { name: "áƒ’áƒ£áƒ’áƒ áƒ‘áƒáƒšáƒáƒœáƒ©áƒ˜áƒ•áƒáƒ«áƒ”", phone: "577978792" }
    ];

    let currentScheduleData = [];
    const monthsKA = ["áƒ˜áƒáƒœáƒ•áƒáƒ áƒ˜", "áƒ—áƒ”áƒ‘áƒ”áƒ áƒ•áƒáƒšáƒ˜", "áƒ›áƒáƒ áƒ¢áƒ˜", "áƒáƒáƒ áƒ˜áƒšáƒ˜", "áƒ›áƒáƒ˜áƒ¡áƒ˜", "áƒ˜áƒ•áƒœáƒ˜áƒ¡áƒ˜", "áƒ˜áƒ•áƒšáƒ˜áƒ¡áƒ˜", "áƒáƒ’áƒ•áƒ˜áƒ¡áƒ¢áƒ", "áƒ¡áƒ”áƒ¥áƒ¢áƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒáƒ¥áƒ¢áƒáƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒœáƒáƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒ“áƒ”áƒ™áƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜"];

    function generateRandom() {
        const s = document.getElementById('startMonth').value, e = document.getElementById('endMonth').value;
        if(!s || !e) return alert("áƒáƒ˜áƒ áƒ©áƒ˜áƒ”áƒ— áƒáƒ”áƒ áƒ˜áƒáƒ“áƒ˜!");
        let shuffled = [...staff].sort(() => Math.random() - 0.5);
        let cur = new Date(Date.UTC(s.split('-')[0], s.split('-')[1]-1, 1));
        const end = new Date(Date.UTC(e.split('-')[0], e.split('-')[1], 0));
        currentScheduleData = [];
        let idx = 0;
        while(cur <= end) {
            let p = shuffled[idx % shuffled.length];
            currentScheduleData.push({ 
                day: cur.getUTCDate(), month: cur.getUTCMonth(), year: cur.getUTCFullYear(), 
                isWeekend: (cur.getUTCDay() === 0 || cur.getUTCDay() === 6), 
                staffName: p.name, staffPhone: p.phone 
            });
            idx++; cur.setUTCDate(cur.getUTCDate() + 1);
        }
        updateStaffUI(); renderPreview();
    }

    function updateStaffUI() {
        const counts = {};
        currentScheduleData.forEach(d => { counts[d.staffName] = (counts[d.staffName] || 0) + 1; });
        document.getElementById('statsUI').innerHTML = staff.map(s => `<div style="display:flex; justify-content:space-between; margin-bottom:5px;"><span>${s.name}</span><span class="count-badge">${counts[s.name] || 0}</span></div>`).join('');
    }

    function renderPreview() {
        const title = document.getElementById('topTitleInput').value || "áƒ¡áƒáƒ›áƒ£áƒ¨áƒáƒ áƒ’áƒáƒœáƒ áƒ˜áƒ’áƒ˜";
        let html = `<div class="today-card"><h3>ğŸ”” áƒ“áƒ¦áƒ”áƒ•áƒáƒœáƒ“áƒ”áƒšáƒ˜ áƒ›áƒáƒ áƒ˜áƒ’áƒ”</h3><div style="font-size:20px; font-weight:bold;">áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ”áƒ‘áƒ˜ áƒ©áƒáƒ˜áƒ¢áƒ•áƒ˜áƒ áƒ—áƒ”áƒ‘áƒ...</div></div><h2 style="text-align:center; color:#8b0000;">${title}</h2>`;
        let lastMonth = -1;

        currentScheduleData.forEach((item, i) => {
            if (item.month !== lastMonth) {
                if (lastMonth !== -1) html += "</tbody></table>";
                html += `<div class="month-row"><span>${monthsKA[item.month]} ${item.year}</span><span class="live-clock">ğŸ“…</span></div><table><tbody>`;
                lastMonth = item.month;
            }
            html += `<tr class="${item.isWeekend?'weekend':''}">
                <td style="width:15%;"><b>${item.day}</b></td>
                <td><b>${item.staffName}</b></td>
                <td style="width:40%;"><div class="phone-group"><a href="tel:${item.staffPhone}" class="call-btn">ğŸ“ ${item.staffPhone}</a><div class="viber-btn">VIBER</div></div></td>
            </tr>`;
        });
        document.getElementById('schedulePreview').innerHTML = html + "</tbody></table>";
    }

    function copyFinalHTML() {
        const title = document.getElementById('topTitleInput').value || "áƒ¡áƒáƒ›áƒ£áƒ¨áƒáƒ áƒ’áƒáƒœáƒ áƒ˜áƒ’áƒ˜";
        let tableRows = currentScheduleData.map(item => 
            `<tr class="${item.isWeekend?'weekend':''}" data-d="${item.day}" data-m="${item.month}" data-y="${item.year}" data-n="${item.staffName}" data-p="${item.staffPhone}">
                <td style="width:15%;"><b>${item.day}</b></td>
                <td style="width:45%;"><b>${item.staffName}</b></td>
                <td style="width:40%;">
                    <div class="phone-group">
                        <a href="tel:${item.staffPhone}" class="call-btn">ğŸ“ ${item.staffPhone}</a>
                        <div onclick="viber('${item.staffPhone}')" class="viber-btn">VIBER</div>
                    </div>
                </td>
            </tr>`).join('');

        const final = `<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><style>
            body { font-family: sans-serif; background: #f4f7f9; padding: 10px; margin: 0; }
            .container { max-width: 500px; margin: auto; background: white; padding: 15px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
            .today-box { background: linear-gradient(135deg, #8b0000, #c0392b); color: white; padding: 20px; border-radius: 12px; text-align: center; margin-bottom: 20px; }
            .month-header { display: flex; justify-content: space-between; align-items: center; background: #eee; padding: 10px; margin-top: 20px; border-radius: 5px; border-left: 5px solid #8b0000; font-weight: bold; }
            table { width: 100%; border-collapse: collapse; }
            td { padding: 12px 5px; border-bottom: 1px solid #eee; font-size: 14px; }
            .weekend { background: #fff5f5; color: #d9534f; }
            .phone-group { display: flex; flex-direction: column; gap: 4px; }
            .call-btn { background: #007bff; color: white !important; text-decoration: none; padding: 10px; border-radius: 6px; text-align: center; font-weight: bold; font-size: 13px; }
            .viber-btn { background: #7360f2; color: white !important; padding: 8px; border-radius: 6px; text-align: center; font-weight: 900; font-size: 11px; cursor: pointer; }
        </style></head><body>
        <div class="container">
            <div id="hero" class="today-box"></div>
            <h2 style="text-align:center; color:#8b0000; margin: 10px 0;">${title}</h2>
            <div id="content"></div>
        </div>
        <script>
            const data = [${currentScheduleData.map(i => `{d:${i.day},m:${i.month},y:${i.year},n:'${i.staffName}',p:'${i.staffPhone}',w:${i.isWeekend}}`).join(',')}];
            const months = ["áƒ˜áƒáƒœáƒ•áƒáƒ áƒ˜", "áƒ—áƒ”áƒ‘áƒ”áƒ áƒ•áƒáƒšáƒ˜", "áƒ›áƒáƒ áƒ¢áƒ˜", "áƒáƒáƒ áƒ˜áƒšáƒ˜", "áƒ›áƒáƒ˜áƒ¡áƒ˜", "áƒ˜áƒ•áƒœáƒ˜áƒ¡áƒ˜", "áƒ˜áƒ•áƒšáƒ˜áƒ¡áƒ˜", "áƒáƒ’áƒ•áƒ˜áƒ¡áƒ¢áƒ", "áƒ¡áƒ”áƒ¥áƒ¢áƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒáƒ¥áƒ¢áƒáƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒœáƒáƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒ“áƒ”áƒ™áƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜"];
            
            function viber(p) { window.location.href = "viber://contact?number=%2B" + (p.startsWith('5') ? '995'+p : p); }

            function render() {
                const now = new Date();
                const d = now.getDate(), m = now.getMonth(), y = now.getFullYear();
                
                // 1. Update Hero (Today's Duty)
                const today = data.find(x => x.d === d && x.m === m && x.y === y);
                const hero = document.getElementById('hero');
                if(today) {
                    hero.innerHTML = '<div style="font-size:14px; opacity:0.9;">ğŸ”” áƒ“áƒ¦áƒ”áƒ•áƒáƒœáƒ“áƒ”áƒšáƒ˜ áƒ›áƒáƒ áƒ˜áƒ’áƒ”</div><div style="font-size:24px; font-weight:900; margin:10px 0;">' + today.n + '</div><div style="display:flex; gap:10px; justify-content:center;"><a href="tel:'+today.p+'" class="call-btn" style="background:white; color:#8b0000; width:120px;">ğŸ“ áƒ“áƒáƒ áƒ”áƒ™áƒ•áƒ</a><div onclick="viber(\\"'+today.p+'\\")" class="viber-btn" style="background:white; color:#7360f2; width:80px; line-height:24px;">VIBER</div></div>';
                } else { hero.style.display = 'none'; }

                // 2. Render List
                let html = "", lastM = -1;
                data.forEach(item => {
                    if(item.m !== lastM) {
                        if(lastM !== -1) html += "</tbody></table>";
                        html += '<div class="month-header"><span>' + months[item.m] + ' ' + item.y + '</span><span style="color:#d00000; font-size:12px;">ğŸ“… ' + d + ' ' + months[m] + '</span></div><table><tbody>';
                        lastM = item.m;
                    }
                    html += '<tr class="' + (item.w ? 'weekend' : '') + '"><td><b>' + item.d + '</b></td><td><b>' + item.n + '</b></td><td><div class="phone-group"><a href="tel:'+item.p+'" class="call-btn">ğŸ“ '+item.p+'</a><div onclick="viber(\\"'+item.p+'\\")" class="viber-btn">VIBER</div></div></td></tr>';
                });
                document.getElementById('content').innerHTML = html + '</tbody></table>';
            }
            render();
            setInterval(render, 60000); // Refresh every minute
        <\/script></body></html>`;

        const el = document.getElementById('codeOutput'); el.value = final;
        el.style.display="block"; el.select(); document.execCommand('copy'); el.style.display="none";
        alert("áƒ“áƒáƒ¡áƒáƒ™áƒáƒáƒ˜áƒ áƒ”áƒ‘áƒ”áƒšáƒ˜ áƒ™áƒáƒ“áƒ˜ áƒ›áƒ–áƒáƒ“áƒáƒ!");
    }
</script>
</body>
</html>
