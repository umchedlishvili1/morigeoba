<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DutyPlanner Pro - Ultimate Generator</title>
    <style>
        :root { --primary: #4361ee; --dark-red: #8b0000; --bg: #f0f2f5; --sidebar-bg: #1e1e2d; --viber-bg: #7360f2; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); margin: 0; display: flex; height: 100vh; overflow: hidden; }

        /* Sidebar Styling */
        #sidebar { width: 360px; background: var(--sidebar-bg); color: white; padding: 25px; overflow-y: auto; flex-shrink: 0; box-shadow: 4px 0 15px rgba(0,0,0,0.2); }
        .input-group { margin-bottom: 18px; background: rgba(255,255,255,0.06); padding: 15px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1); }
        label { display: block; font-size: 11px; text-transform: uppercase; margin-bottom: 8px; color: var(--primary); font-weight: 800; letter-spacing: 1px; }
        input, select { background: #2a2a3d; border: 1px solid #444; color: white; padding: 12px; border-radius: 6px; width: 100%; box-sizing: border-box; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--primary); background: #32324a; }
        
        /* Buttons */
        .btn { padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: 700; width: 100%; transition: 0.3s; margin-top: 8px; display: block; text-align: center; text-decoration: none; }
        .btn-gen { background: #9b59b6; color: white; }
        .btn-gen:hover { background: #8e44ad; }
        .btn-copy { background: #2ecc71; color: white; font-size: 16px; margin-top: 25px; height: 55px; box-shadow: 0 4px 15px rgba(46,204,113,0.3); }
        .btn-copy:hover { background: #27ae60; transform: translateY(-2px); }

        /* Preview Area */
        #main { flex-grow: 1; padding: 30px; overflow-y: auto; background: #e9ecef; display: flex; justify-content: center; }
        #schedulePreview { width: 100%; max-width: 500px; }

        .list-item { display: flex; justify-content: space-between; background: rgba(255,255,255,0.1); padding: 8px 12px; border-radius: 5px; margin-top: 5px; font-size: 13px; border-left: 3px solid var(--primary); }
        .list-item span.remove { color: #ff5e5e; cursor: pointer; font-weight: bold; padding: 0 5px; }
    </style>
</head>
<body>

<div id="sidebar">
    <h2 style="color:var(--primary); margin: 0 0 25px 0; font-size: 24px;">DutyPlanner <span style="font-weight:200; color:white;">Pro</span></h2>
    
    <div class="input-group">
        <label>áƒ’áƒáƒœáƒ áƒ˜áƒ’áƒ˜áƒ¡ áƒ¡áƒáƒ—áƒáƒ£áƒ áƒ˜</label>
        <input type="text" id="topTitleInput" value="áƒáƒ˜áƒ¢áƒ˜-áƒ¢áƒ”áƒ¥áƒœáƒ˜áƒ™áƒ£áƒ áƒ˜ áƒ—áƒáƒœáƒáƒ›áƒ¨áƒ áƒáƒ›áƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ’áƒáƒœáƒ áƒ˜áƒ’áƒ˜" oninput="renderPreview()">
    </div>
    
    <div class="input-group">
        <label>áƒáƒ”áƒ áƒ˜áƒáƒ“áƒ˜ (áƒ—áƒ•áƒ˜áƒ“áƒáƒœ - áƒ—áƒ•áƒ”áƒ›áƒ“áƒ”)</label>
        <div style="display:flex; gap:8px;">
            <input type="month" id="startMonth">
            <input type="month" id="endMonth">
        </div>
        <button class="btn btn-gen" onclick="generateLogic()">ğŸ² áƒ’áƒáƒœáƒ áƒ˜áƒ’áƒ˜áƒ¡ áƒ’áƒ”áƒœáƒ”áƒ áƒ˜áƒ áƒ”áƒ‘áƒ</button>
    </div>

    <div class="input-group">
        <label>áƒáƒ”áƒ áƒ¡áƒáƒœáƒáƒšáƒ˜áƒ¡ áƒ‘áƒáƒ–áƒ</label>
        <input type="text" id="staffName" placeholder="áƒ¡áƒáƒ®áƒ”áƒšáƒ˜ áƒ’áƒ•áƒáƒ áƒ˜">
        <input type="text" id="staffPhone" placeholder="577 00 00 00" style="margin-top:5px;">
        <button class="btn" style="background:var(--primary); color:white;" onclick="addItem('staff')">+ áƒ¡áƒ˜áƒáƒ¨áƒ˜ áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ</button>
        <div id="staffListUI" style="margin-top:12px; max-height: 140px; overflow-y: auto;"></div>
    </div>

    <div class="input-group">
        <label>áƒáƒ“áƒ›áƒ˜áƒœáƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒ</label>
        <input type="text" id="adminName" placeholder="áƒáƒáƒ¡áƒ£áƒ®áƒ˜áƒ¡áƒ›áƒ’áƒ”áƒ‘áƒ”áƒšáƒ˜ áƒáƒ˜áƒ áƒ˜">
        <input type="text" id="adminPhone" placeholder="áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜áƒ¡ áƒœáƒáƒ›áƒ”áƒ áƒ˜" style="margin-top:5px;">
        <button class="btn" style="background:#e67e22; color:white;" onclick="addItem('admin')">+ áƒáƒ“áƒ›áƒ˜áƒœáƒ˜áƒ¡ áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ</button>
        <div id="adminListUI" style="margin-top:10px;"></div>
    </div>

    <button class="btn btn-copy" onclick="copyFinalHTML()">ğŸ“‹ áƒ¡áƒáƒ‘áƒáƒšáƒáƒ áƒ™áƒáƒ“áƒ˜áƒ¡ áƒ™áƒáƒáƒ˜áƒ áƒ”áƒ‘áƒ</button>
</div>

<div id="main">
    <div id="schedulePreview">
        <div style="text-align:center; color:#888; margin-top:100px;">
            <h3>áƒ’áƒáƒœáƒ áƒ˜áƒ’áƒ˜ áƒªáƒáƒ áƒ˜áƒ”áƒšáƒ˜áƒ</h3>
            <p>áƒ¨áƒ”áƒáƒ•áƒ¡áƒ”áƒ— áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ”áƒ‘áƒ˜ áƒ“áƒ áƒ“áƒáƒáƒ­áƒ˜áƒ áƒ”áƒ— áƒ’áƒ”áƒœáƒ”áƒ áƒ˜áƒ áƒ”áƒ‘áƒáƒ¡</p>
        </div>
    </div>
</div>

<textarea id="hiddenClipboard" style="display:none;"></textarea>

<script>
    let staff = JSON.parse(localStorage.getItem('pro_staff')) || [];
    let admins = JSON.parse(localStorage.getItem('pro_admins')) || [];
    let schedule = [];
    const kaMonths = ["áƒ˜áƒáƒœáƒ•áƒáƒ áƒ˜", "áƒ—áƒ”áƒ‘áƒ”áƒ áƒ•áƒáƒšáƒ˜", "áƒ›áƒáƒ áƒ¢áƒ˜", "áƒáƒáƒ áƒ˜áƒšáƒ˜", "áƒ›áƒáƒ˜áƒ¡áƒ˜", "áƒ˜áƒ•áƒœáƒ˜áƒ¡áƒ˜", "áƒ˜áƒ•áƒšáƒ˜áƒ¡áƒ˜", "áƒáƒ’áƒ•áƒ˜áƒ¡áƒ¢áƒ", "áƒ¡áƒ”áƒ¥áƒ¢áƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒáƒ¥áƒ¢áƒáƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒœáƒáƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒ“áƒ”áƒ™áƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜"];

    function addItem(type) {
        const n = document.getElementById(type + 'Name'), p = document.getElementById(type + 'Phone');
        if(!n.value) return;
        if(type === 'staff') staff.push({name: n.value, phone: p.value});
        else admins.push({name: n.value, phone: p.value});
        save(); updateUI(); n.value=""; p.value=""; renderPreview();
    }

    function save() {
        localStorage.setItem('pro_staff', JSON.stringify(staff));
        localStorage.setItem('pro_admins', JSON.stringify(admins));
    }

    function updateUI() {
        document.getElementById('staffListUI').innerHTML = staff.map((s, i) => `<div class="list-item">${s.name} <span class="remove" onclick="staff.splice(${i},1);save();updateUI();renderPreview();">Ã—</span></div>`).join('');
        document.getElementById('adminListUI').innerHTML = admins.map((a, i) => `<div class="list-item">${a.name} <span class="remove" onclick="admins.splice(${i},1);save();updateUI();renderPreview();">Ã—</span></div>`).join('');
    }

    function generateLogic() {
        const sM = document.getElementById('startMonth').value, eM = document.getElementById('endMonth').value;
        if(!sM || !eM || staff.length === 0) return alert("áƒ¨áƒ”áƒáƒ•áƒ¡áƒ”áƒ— áƒ—áƒáƒ áƒ˜áƒ¦áƒ”áƒ‘áƒ˜ áƒ“áƒ áƒáƒ”áƒ áƒ¡áƒáƒœáƒáƒšáƒ˜!");
        
        schedule = [];
        let start = new Date(sM + "-01"), end = new Date(eM + "-01");
        end.setMonth(end.getMonth() + 1); end.setDate(0);

        let pool = [...staff].sort(() => Math.random() - 0.5);
        let curr = new Date(start), i = 0;

        while(curr <= end) {
            let p = pool[i % pool.length];
            schedule.push({
                d: curr.getDate(), m: curr.getMonth(), y: curr.getFullYear(),
                isW: (curr.getDay() === 0 || curr.getDay() === 6),
                name: p.name, phone: p.phone
            });
            curr.setDate(curr.getDate() + 1); i++;
        }
        renderPreview();
    }

    function renderPreview() {
        if(schedule.length === 0) return;
        const title = document.getElementById('topTitleInput').value;
        
        let html = `
            <div style="background:white; padding:20px; border-radius:15px; color:#333; box-shadow:0 10px 30px rgba(0,0,0,0.1);">
                <div id="live-today-card" style="background:linear-gradient(135deg, #8b0000, #c0392b); color:white; padding:20px; border-radius:12px; text-align:center; margin-bottom:25px;">
                    <div style="font-size:13px; opacity:0.8;">ğŸ”” áƒ“áƒ¦áƒ”áƒ•áƒáƒœáƒ“áƒ”áƒšáƒ˜ áƒ›áƒáƒ áƒ˜áƒ’áƒ”</div>
                    <div id="sync-name" style="font-size:26px; font-weight:900; margin:10px 0;">(áƒ¡áƒ˜áƒœáƒ¥áƒ áƒáƒœáƒ˜áƒ–áƒáƒªáƒ˜áƒ...)</div>
                    <div id="sync-actions"></div>
                </div>
                <h1 style="text-align:center; color:#8b0000; font-size:20px;">${title}</h1>`;

        let lastM = -1;
        schedule.forEach((day, idx) => {
            if(day.m !== lastM) {
                if(lastM !== -1) html += `</tbody></table>`;
                html += `<div style="background:#f8f9fa; padding:12px; border-radius:8px; border-left:5px solid #8b0000; margin:25px 0 10px 0; display:flex; justify-content:space-between; align-items:center;">
                    <b style="font-size:15px;">${kaMonths[day.m]} ${day.y}</b>
                    <span class="current-time-inline" style="font-size:12px; color:#d00000; font-weight:bold; background:white; padding:3px 8px; border-radius:4px; border:1px solid #ddd;">ğŸ“… áƒ˜áƒ¢áƒ•áƒ˜áƒ áƒ—áƒ”áƒ‘áƒ...</span>
                </div><table style="width:100%; border-collapse:collapse;"><tbody>`;
                lastM = day.m;
            }
            
            const staffOptions = staff.map(s => `<option value="${s.name}" ${s.name === day.name ? 'selected' : ''}>${s.name}</option>`).join('');
            
            html += `<tr style="border-bottom:1px solid #eee;" class="${day.isW ? 'weekend-row' : ''}">
                <td style="padding:10px; font-weight:bold; width:40px;">${day.d}</td>
                <td><select onchange="updatePerson(${idx}, this.value)" style="width:100%; border:none; background:none; font-weight:bold; cursor:pointer;">${staffOptions}</select></td>
                <td style="text-align:right; font-size:12px; font-weight:bold; white-space:nowrap;">ğŸ“ ${day.phone}</td>
            </tr>`;
        });

        let admHTML = admins.length > 0 ? `<div style="margin-top:30px; border-top:2px dashed #ddd; padding-top:20px; text-align:center;"><h4 style="color:#666; font-size:14px; margin-bottom:15px;">âš ï¸ áƒáƒáƒ¡áƒ£áƒ®áƒ˜áƒ¡áƒ›áƒ’áƒ”áƒ‘áƒ”áƒšáƒ˜ áƒáƒ˜áƒ áƒ”áƒ‘áƒ˜</h4>` + 
            admins.map(a => `<div style="margin-bottom:10px;"><b>${a.name}</b><br><span style="font-size:13px;">ğŸ“ ${a.phone}</span></div>`).join('') + `</div>` : "";

        document.getElementById('schedulePreview').innerHTML = html + `</tbody></table>${admHTML}</div>`;
    }

    function updatePerson(idx, newName) {
        const p = staff.find(s => s.name === newName);
        schedule[idx].name = p.name; schedule[idx].phone = p.phone; renderPreview();
    }

    function copyFinalHTML() {
        const title = document.getElementById('topTitleInput').value;
        let temp = document.createElement('div');
        temp.innerHTML = document.getElementById('schedulePreview').innerHTML;
        
        // áƒ¡áƒ”áƒšáƒ”áƒ¥áƒ¢áƒ”áƒ‘áƒ˜áƒ¡ áƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒáƒ“ áƒ¥áƒªáƒ”áƒ•áƒ
        temp.querySelectorAll('select').forEach(sel => {
            let b = document.createElement('b'); b.innerText = sel.value;
            sel.parentNode.replaceChild(b, sel);
        });

        // áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ”áƒ‘áƒ˜áƒ¡ áƒ“áƒ áƒ•áƒ˜áƒ‘áƒ”áƒ áƒ˜áƒ¡ áƒ¦áƒ˜áƒšáƒáƒ™áƒ”áƒ‘áƒ˜áƒ¡ áƒ’áƒ”áƒœáƒ”áƒ áƒ˜áƒ áƒ”áƒ‘áƒ áƒªáƒ®áƒ áƒ˜áƒšáƒ¨áƒ˜
        temp.querySelectorAll('tr').forEach(tr => {
            let phoneCell = tr.cells[2];
            if(phoneCell) {
                let raw = phoneCell.innerText.replace('ğŸ“','').trim();
                let clean = raw.replace(/\D/g,'');
                phoneCell.innerHTML = `<div style="display:flex; flex-direction:column; gap:3px;">
                    <a href="tel:${clean}" style="background:#007bff; color:white; text-decoration:none; padding:6px; border-radius:4px; font-size:11px; text-align:center; font-weight:bold;">ğŸ“ ${raw}</a>
                    <a href="viber://contact?number=%2B995${clean.slice(-9)}" style="background:#7360f2; color:white; text-decoration:none; padding:4px; border-radius:4px; font-size:9px; text-align:center; font-weight:900;">VIBER</a>
                </div>`;
            }
        });

        const finalCode = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: sans-serif; background: #f4f7f6; padding: 10px; margin: 0; }
        .wrapper { max-width: 500px; margin: auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        .today-card { background: linear-gradient(135deg, #8b0000, #c0392b); color: white; padding: 22px; border-radius: 12px; text-align: center; margin-bottom: 25px; box-shadow: 0 8px 16px rgba(139,0,0,0.2); }
        .active-row { background: #fff3cd !important; border: 2px solid #8b0000; box-shadow: inset 0 0 10px rgba(0,0,0,0.05); }
        .weekend-row { background: #fff9f9; color: #d9534f; }
        td { border-bottom: 1px solid #eee; padding: 12px 8px; font-size: 14px; }
        .btn-sync-call { background: white; color: #8b0000 !important; text-decoration: none; padding: 10px; border-radius: 6px; font-size: 14px; font-weight: bold; display: block; margin-bottom: 5px; }
        .btn-sync-viber { background: rgba(255,255,255,0.2); color: white !important; text-decoration: none; padding: 8px; border-radius: 6px; font-size: 11px; font-weight: bold; display: block; }
    </style>
</head>
<body>
    <div class="wrapper">${temp.innerHTML}</div>
    <script>
        const mNames = ["áƒ˜áƒáƒœáƒ•áƒáƒ áƒ˜", "áƒ—áƒ”áƒ‘áƒ”áƒ áƒ•áƒáƒšáƒ˜", "áƒ›áƒáƒ áƒ¢áƒ˜", "áƒáƒáƒ áƒ˜áƒšáƒ˜", "áƒ›áƒáƒ˜áƒ¡áƒ˜", "áƒ˜áƒ•áƒœáƒ˜áƒ¡áƒ˜", "áƒ˜áƒ•áƒšáƒ˜áƒ¡áƒ˜", "áƒáƒ’áƒ•áƒ˜áƒ¡áƒ¢áƒ", "áƒ¡áƒ”áƒ¥áƒ¢áƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒáƒ¥áƒ¢áƒáƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒœáƒáƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒ“áƒ”áƒ™áƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜"];
        function sync() {
            const now = new Date();
            const d = now.getDate(), m = now.getMonth(), y = now.getFullYear();
            const timeStr = d + " " + mNames[m] + " | " + String(now.getHours()).padStart(2,'0') + ":" + String(now.getMinutes()).padStart(2,'0') + ":" + String(now.getSeconds()).padStart(2,'0');
            
            document.querySelectorAll('.current-time-inline').forEach(el => el.innerText = "ğŸ“… " + timeStr);
            
            document.querySelectorAll('tr').forEach(row => {
                const rowDay = parseInt(row.cells[0].innerText);
                const parentHeader = row.closest('table').previousElementSibling.innerText;
                
                if(rowDay === d && parentHeader.includes(mNames[m]) && parentHeader.includes(y)) {
                    row.classList.add('active-row');
                    const name = row.cells[1].innerText;
                    const phoneLink = row.cells[2].querySelector('a').getAttribute('href');
                    const phoneNum = row.cells[2].querySelector('a').innerText;
                    const viberLink = row.cells[2].querySelectorAll('a')[1].getAttribute('href');
                    
                    document.getElementById('sync-name').innerText = name;
                    document.getElementById('sync-actions').innerHTML = \`
                        <a href="\${phoneLink}" class="btn-sync-call">\${phoneNum}</a>
                        <a href="\${viberLink}" class="btn-sync-viber">VIBER</a>\`;
                } else { row.classList.remove('active-row'); }
            });
        }
        setInterval(sync, 1000); sync();
    <\/script>
</body>
</html>`;
        
        const clip = document.getElementById('hiddenClipboard');
        clip.value = finalCode; clip.style.display="block"; clip.select();
        document.execCommand('copy'); clip.style.display="none";
        alert("âœ… áƒ™áƒáƒ“áƒ˜ áƒ¡áƒ˜áƒœáƒ¥áƒ áƒáƒœáƒ˜áƒ–áƒ”áƒ‘áƒ£áƒšáƒ˜áƒ áƒ“áƒ áƒ“áƒáƒ™áƒáƒáƒ˜áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜áƒ!");
    }
    window.onload = updateUI;
</script>
</body>
</html>
